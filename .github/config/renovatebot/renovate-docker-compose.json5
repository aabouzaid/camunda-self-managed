{
  "extends": [
    "config:recommended",
    ":docker"
  ],
  "description": "Keeps docker-compose up to date",
  "packageRules": [
    {
      // Disable major version update for all Helm components.
      "enabled": false,
      "matchManagers": ["regex"],
      "matchUpdateTypes": ["major"]
    },
    // Disable deprecated stable versions.
    {
      "matchFileNames": [
        "docker-compose/versions/camunda-8.0/**",
        "docker-compose/versions/camunda-8.1/**",
        "docker-compose/versions/camunda-8.2/**",
        ],
      "enabled": false
    },
    {
      // Disable minor version update for previous Camunda releases which will only get patch updates.
      "enabled": false,
      "matchManagers": ["regex"],
      "matchPaths": [".env"],
      "matchFileNames": ["docker-compose/versions/camunda-8\\..*/**"],
      "matchUpdateTypes": ["minor"]
    },

    //
    // Main groups.
    // This section should be updated with the Camunda supported versions.
    // Start of minor cycle chores.
    {
      "groupName": "camunda-docker-compose-8.3",
      "addLabels": ["version/8.3", "deps/docker-compose"],
      "matchFileNames": [
        "docker-compose/versions/camunda-8.3/**"
      ],
      "matchUpdateTypes": ["patch"],
    },
    {
      "groupName": "camunda-docker-compose-8.4",
      "addLabels": ["version/8.4", "deps/docker-compose"],
      "matchFileNames": [
        "docker-compose/versions/camunda-8.4/**"
      ],
      "matchUpdateTypes": ["patch"],
    },
    {
      "groupName": "camunda-docker-compose-8.5",
      "addLabels": ["version/8.5", "deps/docker-compose"],
      "matchFileNames": [
        "docker-compose/versions/camunda-8.5/**"
      ],
      "matchUpdateTypes": ["patch"],
    },
    {
      "groupName": "camunda-docker-compose-8.6",
      "addLabels": ["version/8.6", "deps/docker-compose"],
      "matchFileNames": [
        "docker-compose/versions/camunda-8.6/**"
      ],
      "matchUpdateTypes": ["patch"],
    },
    {
      "groupName": "camunda-docker-compose-alpha",
      "addLabels": ["version/8.7", "deps/docker-compose"],
      "matchFileNames": [
        "docker-compose/versions/camunda-alpha/**"
      ],
      "matchUpdateTypes": ["patch", "minor"],
    },
    // End of minor cycle chores.

    // Others.
    {
      "matchDepNames": ["bitnami/keycloak"],
      "matchUpdateTypes": ["major", "minor"],
      "enabled": false,
    },
    {
      "matchDatasources": ["go"],
      "enabled": false,
    },
    {
      "matchUpdateTypes": ["minor", "patch"],
      "automerge": true,
    },
    // disable auto-merge for alpha release candidates
    {
      "matchNewValue": "/.*alpha[0-9]*-rc[0-9]*/",
      "automerge": false
    },
    {
      // we manually made this package for renovate.
      // no need to update it again
      "matchDepNames": ["docker.io/bitnami/keycloak"],
      "enabled": false,
    },
  ],

  "regexManagers": [
    {
      // This is mainly used to update Web-Modeler image tag.
      // section is copied from camunda/camunda-platform-helm
      "fileMatch": [".env"],
      "datasourceTemplate":"docker",
      "matchStrings": [
        "# renovate: datasource=docker depName=(?<depName>[^\\s]+?)(?: (lookupName|packageName)=(?<packageName>[^\\s]+?))?(?: versioning=(?<versioning>[^\\s]+?))?(?: registryUrl=(?<registryUrl>[^\\s]+?))?\\s*?(\\S+)=(?<currentValue>\\S+)"
      ],
      "versioningTemplate": "{{#if versioning}}{{{versioning}}}{{else}}semver{{/if}}"
    },
    {
      "fileMatch": [".env", ".keycloak/Dockerfile"],
      "matchStrings": ["KEYCLOAK_SERVER_VERSION\\s*=\\s*(?<currentValue>\\S+)", "KEYCLOAK_VERSION\\s*=\\s*(?<currentValue>\\S+)"],
      "depNameTemplate": "bitnami/keycloak",
      "datasourceTemplate": "docker",
    },
  ],
}
